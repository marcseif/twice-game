const members = [
  {
    name: "Nayeon",
    images: [
      "https://kpopping.com/documents/9f/0/800/250720-NAYEON-at-THIS-IS-FOR-World-Tour-in-Incheon-D2-documents-1.jpeg",
      "https://kpopping.com/documents/ba/2/800/NAYEON-x-Finger-Suit-Japan-documents-1.jpeg",
      "https://kpopping.com/documents/a2/1/800/250208-NAYEON-Instagram-Update-documents-1.jpeg?v=c7f9c",
      "https://kpopping.com/documents/9b/1/800/241214-NAMING-Japan-X-Update-with-NAYEON-documents-1.jpeg?v=95233",
      "https://kpopping.com/documents/b9/1/800/230922-JYP-Fans-Update-Happy-Birthday-Nayeon-documents-1.jpeg?v=d965b",
    ],
  },
  {
    name: "Jeongyeon",
    images: [
      "https://kpopping.com/documents/4a/4/800/241203-JEONGYEON-Instagram-Update-documents-1.jpeg?v=4bdd4",
      "https://kpopping.com/documents/f5/3/800/240303-TWICE-Jeongyeon-Blue-Dream-Media-Fansign-documents-1.jpeg?v=5092c",
      "https://kpopping.com/documents/fd/0/800/TWICE-Jeongyeon-2nd-Full-Album-Eyes-wide-open-Promotion-Photoshoot-by-Naver-x-Dispatch-documents-1.jpeg?v=1fb1e",
      "https://kpopping.com/documents/57/1/800/250701-JEONGYEON-Instagram-Update-documents-1.jpeg",
      "https://kpopping.com/documents/5c/5/800/wherever_yuare-1179644628548456448-EF7weUnU0AE1nte.webp?v=35dd0",
    ],
  },
  {
    name: "Momo",
    images: [
      "https://kpopping.com/documents/63/1/800/250803-MOMO-AT-LOLLAPALOOZA-2025-documents-1.jpeg",
      "https://kpopping.com/documents/47/1/800/250616-MOMO-Instagram-Update-documents-1.jpeg",
      "https://kpopping.com/documents/09/5/800/240919-MOMO-Instagram-Update-documents-6.jpeg?v=c7f9c",
      "https://kpopping.com/documents/a9/1/800/240616-MOMO-Instagram-Update-documents-1.jpeg?v=c7f9c",
      "https://kpopping.com/documents/3f/1/800/240308-MOMO-Instagram-Update-documents-1.jpeg?v=c7f9c",
    ],
  },
  {
    name: "Sana",
    images: [
      "https://kpopping.com/documents/f0/4/800/250713-SANA-AT-SBS-documents-1.jpeg",
      "https://kpopping.com/documents/2b/4/800/221119-TWICE-Sana-Instagram-Update-documents-1.jpeg?v=c7f9c",
      "https://kpopping.com/documents/c0/3/800/240719-SANA-Instagram-Update-documents-1.jpeg?v=c7f9c",
      "https://kpopping.com/documents/83/0/800/TWICE-SANA-FOR-ELLE-KOREA-SCANS-documents-1.jpeg?v=82268",
      "https://kpopping.com/documents/aa/3/800/230319-TWICE-Sana-Mini-Fanmeet-documents-2.jpeg?v=866ea",
    ],
  },
  {
    name: "Jihyo",
    images: [
      "https://kpopping.com/documents/ad/1/800/241213-JIHYO-Instagram-Update-documents-1.jpeg?v=8771d",
      "https://kpopping.com/documents/03/5/800/240727-TWICE-Jihyo-5th-World-Tour-Ready-To-Be-in-Yokohama-Day-1-documents-1.jpeg?v=c6b97",
      "https://kpopping.com/documents/c0/1/800/230819-JIHYO-Instagram-Update-documents-1.jpeg?v=c7f9c",
      "https://kpopping.com/documents/a3/4/800/TWICE-Jihyo-x-Milk-Touch-2024-Dreaming-Shell-Jewelry-documents-1(1).jpeg?v=9c744",
      "https://kpopping.com/documents/00/1/800/250711-JIHYO-Instagram-Update-documents-1.jpeg",
    ],
  },
  {
    name: "Mina",
    images: [
      "https://kpopping.com/documents/ab/1/800/241013-MINA-at-Boucheron-Pop-Up-Store-Event-In-Japan-The-Quatre-Experience-documents-1.jpeg?v=2d4fe",
      "https://kpopping.com/documents/29/5/800/230324-JYP-Fans-Update-Happy-Mina-Day-documents-1.jpeg?v=2501c",
      "https://kpopping.com/documents/b6/2/800/220904-TWICE-Mina-documents-1.jpeg?v=59600",
      "https://kpopping.com/documents/94/1/800/250713-MINA-THIS-IS-FOR-at-Inkigayo-documents-2.jpeg",
      "https://kpopping.com/documents/ae/4/800/241206-Twice-Mina-Music-Bank-Commute-documents-2.jpeg?v=e41ab",
    ],
  },
  {
    name: "Dahyun",
    images: [
      "https://kpopping.com/documents/7c/4/800/DAHYUN-x-Michael-Kors-Fall-2024-Campaign-documents-2.jpeg?v=391ea",
      "https://kpopping.com/documents/79/2/800/240601-DAHYUN-Snacktacular-Fan-Meet-in-Manila-documents-1.jpeg?v=d965b",
      "https://kpopping.com/documents/de/5/800/250804-DAHYUN-Instagram-Update-documents-1.jpeg",
      "https://kpopping.com/documents/50/0/800/230319-TWICE-Dahyun-SET-ME-FREE-at-Inkigayo-documents-1.jpeg?v=0e47f",
      "https://kpopping.com/documents/5e/5/800/250523-DAHYUN-instagram-update-documents-1.jpeg",
    ],
  },
  {
    name: "Chaeyoung",
    images: [
      "https://kpopping.com/documents/8d/5/800/TWICE-Chaeyoung-for-CipiCipi-2024-Dewey-Firm-Tint-documents-2.jpeg?v=294df",
      "https://kpopping.com/documents/7a/0/800/240304-CHAEYOUNG-Instagram-Update-documents-1.jpeg?v=c7f9c",
      "https://kpopping.com/documents/a2/4/800/231014-TWICE-Chaeyoung-Lotte-Duty-Free-All-Night-Party-documents-2(5).jpeg?v=5bff1",
      "https://kpopping.com/documents/8f/5/800/250712-CHAEYOUNG-AT-MBC-MINI-FANMEETING-documents-1.jpeg",
      "https://kpopping.com/documents/32/2/800/240722-CHAEYOUNG-Instagram-Update-documents-4.jpeg?v=290c7",
    ],
  },
  {
    name: "Tzuyu",
    images: [
      "https://kpopping.com/documents/3a/2/800/240912-TWICE-Tzuyu-Run-Away-at-M-COUNTDOWN-documents-1.jpeg?v=22225",
      "https://kpopping.com/documents/63/4/800/TWICE-Tzuyu-for-Visee-Killer-Eye-Trio-2024-documents-1.jpeg?v=ca485",
      "https://kpopping.com/documents/8c/1/800/240303-TWICE-Tzuyu-One-Spark-and-I-GOT-YOU-at-Inkigayo-documents-8.jpeg?v=0e47f",
      "https://kpopping.com/documents/27/4/800/TWICE-Tzuyu-for-Visee-Nuance-Dewey-documents-1.jpeg?v=ca485",
      "https://kpopping.com/documents/33/1/800/221002-TWICE-Tzuyu-Instagram-Update-documents-1.jpeg?v=c7f9c",
    ],
  },
];

let currentMember = null;
let usedImages = [];
let correctCount = 0;
const maxRounds = 10;

function getRandomUnusedImage() {
  let attempts = 0;
  while (attempts < 100) {
    const member = members[Math.floor(Math.random() * members.length)];
    const image =
      member.images[Math.floor(Math.random() * member.images.length)];
    const key = `${member.name}-${image}`;
    if (!usedImages.includes(key)) {
      usedImages.push(key);
      return { member, image };
    }
    attempts++;
  }
  return null;
}

function nextImage() {
  document.getElementById("feedback").textContent = "";
  document.getElementById("guess-input").value = "";

  if (correctCount >= maxRounds) {
    endGame(true);
    return;
  }

  const data = getRandomUnusedImage();
  if (!data) {
    endGame(true);
    return;
  }

  currentMember = data.member;
  document.getElementById("member-img").src = data.image;
}

function checkGuess() {
  const input = document.getElementById("guess-input");
  const feedback = document.getElementById("feedback");
  const guess = input.value.trim().toLowerCase();
  const correct = currentMember.name.toLowerCase();

  if (guess === correct) {
    correctCount++;
    feedback.textContent = "‚úÖ Correct!";
    feedback.style.color = "green";
    movePerson(correctCount);
    setTimeout(nextImage, 800);
  } else {
    feedback.textContent = `‚ùå Wrong! It was ${currentMember.name}.`;
    feedback.style.color = "red";
    endGame(false);
  }
}

function endGame(won) {
  const endMsg = document.getElementById("end-message");
  const person = document.getElementById("person");
  const concert = document.getElementById("concert");

  document.getElementById("guess-input").disabled = true;
  document.querySelector("button").disabled = true;

  if (won && correctCount === maxRounds) {
    endMsg.innerHTML = `üéâ Congratulations, you <strong>ARE</strong> going to the concert! <br><img src="https://cdn.vectorstock.com/i/1000v/53/95/thumbs-up-smiley-emoticon-vector-1075395.jpg" height="100">`;
    person.classList.add("celebrating");
    // Final snap to exact center
    const concertCenter = concert.offsetLeft + concert.offsetWidth / 2;
    const personCenter = person.offsetWidth / 2;
    person.style.left = `${concertCenter - personCenter}px`;
  } else {
    endMsg.innerHTML = `üëâ You <strong>are NOT</strong> going to the concert! <br><img src="https://static.vecteezy.com/system/resources/thumbnails/017/260/371/small/hand-pointing-finger-at-you-vector.jpg" height="100">`;
  }

  document.getElementById("retry-container").style.display = "block";
}

function movePerson(count) {
  const person = document.getElementById("person");
  const gameArea = document.getElementById("game-area");
  const concert = document.getElementById("concert");

  const gameWidth = gameArea.offsetWidth;
  const concertX = concert.offsetLeft + concert.offsetWidth / 2;
  const personWidth = person.offsetWidth;

  const maxSteps = maxRounds;
  const stepSize = (concertX - personWidth / 2) / maxSteps;

  const leftPos = stepSize * count;
  person.style.left = `${leftPos}px`;
}

document
  .getElementById("guess-input")
  .addEventListener("keypress", function (e) {
    if (e.key === "Enter") {
      checkGuess();
    }
  });

window.onload = nextImage;

function restartGame() {
  correctCount = 0;
  usedImages = [];
  document.getElementById("end-message").innerHTML = "";
  document.getElementById("feedback").textContent = "";
  document.getElementById("retry-container").style.display = "none";
  document.getElementById("guess-input").disabled = false;
  document.querySelector("button").disabled = false;
  const person = document.getElementById("person");
  person.style.left = "0px";
  person.classList.remove("celebrating");
  nextImage();
}
